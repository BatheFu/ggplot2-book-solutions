---
title: "Exercises"
output: 
  html_document: 
    toc: yes
---

## Chapter 2 - Getting started with ggplot2

```{r}
require(ggplot2, quietly = TRUE)
require(dplyr, quietly = TRUE, warn.conflicts = FALSE)
options(digits = 4, dplyr.print_min = 6, dplyr.print_max = 6)
mpg
```

### Exercises 2.2.1 (Page 14 f.)

__Question 1__: List five functions that you could use to get more information
    about the `mpg` data set.  
__Answer__: Some useful functions are

 + `summary`: print some summary statistics for each variable  
 + `View`: to see the whole data set in a nice spread-sheet like fashion
 + `str` : get info on the structure of the `mpg` object
 + `dplyr::glimps`: similar to `str` but much tidier
 + `class`: to get its class
 
```{r}
glimpse(mpg)
```

__Question 2__: How can you find out what other data sets are included with ggplot2?  
__Answer__: You can find a list of all data set included in ggplot2 at <http://docs.ggplot2.org/current/index.html>.
    
__Question 3__: Apart from the US, most countries use fuel consumption (fuel consumed
    over fixed distance) rather than fuel economy (distance traveled with
    fixed amount of fuel). How could you convert `cty` and `hwy` into the
    European standard of l/100km?  
__Answer__:  

```{r}
mpgTol100km <- function(milespergallon){
  GalloLiter <- 3.785411784
  MileKilometer <- 1.609344 
  
  l100km <- (100*GalloLiter)/(milespergallon*MileKilometer)
  l100km
}
```
We could use `apply` to convert the columns
```{r}
apply(mpg[, c("cty", "hwy")], 2, mpgTol100km) %>% 
  head()
```

Another possibility is to use the `dplyr` functions `transmute` or `mutate` 
```{r}
mpg %>% 
  transmute("cty_l100km" = mpgTol100km(cty),
            "hwy_l100km" = mpgTol100km(hwy))
```

__Question 4__: Which manufacturer has the most models in this data set? Which model has 
    the most variations? Does your answer change if you remove the redundant
    specification of drive train (e.g. "pathfinder 4wd", "a4 quattro") from the 
    model name?  
__Answer to the first part__: 
If we just want the total number of models by manufacturer we use `tally`
```{r}
q4_1 <- mpg %>% 
  group_by(manufacturer) %>% 
  tally(sort = TRUE)
```
If we are looking for most *unique* models by manufacturer 
```{r}
q4_2 <- mpg %>% 
  group_by(manufacturer) %>% 
  transmute("n" = length(unique(model))) %>% 
  unique() %>%
  ungroup() %>% 
  arrange(desc(n))
```

All combined in a plot

```{r}

df <- data.frame(rbind(q4_1, q4_2), "Type" = as.factor(rep(c("overall", "unique"), each = 15)))

ggplot(df, aes(x = reorder(as.factor(manufacturer), n), y = n, fill = Type)) + 
  geom_bar(width = 0.5, stat = "identity", position = "dodge") + 
  ggtitle("Number of models per manufacturer") +
  labs(y = "Count", x = "Model") +
  coord_flip() 
```

__Answer to the second part__: Which model has the most variation

```{r}
unique(mpg$model)
```
The `a4` and the `camry` both have a second model (the `a4 quattro` and the `camry solar`)
Hence, only the `camry` has true model variation. To remove the redundant information
we use functions from the `stringr` package.

```{r eval=FALSE}
require(stringr, quietly = TRUE)

str_trim(str_replace_all(unique(mpg$model), c("quattro" = "", "4wd" = "", 
                                     "2wd" = "", "awd" = "")))

```

### Exercises 2.3.1 (page 16)

```{r}
rm(list = ls()) # clean 

ggplot(mpg, aes(cty, hwy)) +
  geom_point()
```


__Question 1__: How would you describe the relationship between `cty` and `hwy`?
    Do you have any concerns about drawing conclusions from that plot?  
__Answer__: There is a clear linear relationship which is not surprising as both
variables measure fuel economy. Hence, the there is not much inside to be gained
except that cars which are fuel efficient on a highway are also fuel efficient in
cities. This relationship is probably a function of speed.

__Question 2__: What does `ggplot(mpg, aes(model, manufacturer)) + geom_point()` show?
    Is it useful? How could you modify the data to make it more informative?  

```{r}
ggplot(mpg, aes(model, manufacturer)) + 
  geom_point()
```

__Answer__: The plot is not useful for a number of reasons

 + Each dot represents a different manufacturer-model combination that we observe
 in the data. There is no inherent hierarchy so this is just a nominal scale.
 + As there is no interpretable relationship between the points, there is no inside to be gained
from comparing positions (which is the very reason for a scatterplot).
 + Some of the data is hidden as some manufacturer-model combinations appear
 more than once in the data (e.g. `audi a4`).
 + Even if overplotting wouldn't concern us, it is very likely that each unique
 model only pairs with one manufacturer such that a two dimensional plot is 
 redundant.

A possible alternative would be to look total number of observations for each
manufacturer-model combination using `geom_bar()`.

```{r}

df <- mpg %>% 
  transmute("man_mod" = paste(manufacturer, model, sep = " "))


ggplot(df, aes(man_mod)) +
  geom_bar() + 
  coord_flip()
```

  
__Question 3__: Describe the data, aesthetic mappings and layers used for each of the 
    following plots. You'll need to guess a little because you haven't seen
    all the data sets and functions yet, but use your common sense! See if you 
    can predict what the plot will look like before running the code.
    
    1. `ggplot(mpg, aes(cty, hwy)) + geom_point()`
    1. `ggplot(diamonds, aes(carat, price)) + geom_point()`
    1. `ggplot(economics, aes(date, unemploy)) + geom_line()`
    1. `ggplot(mpg, aes(cty)) + geom_histogram()`
    
__Answer__: You can always access info using 
        `summary(<plot>)` as in e.g.
        
```{r}
summary(ggplot(economics, aes(date, unemploy)) + geom_line())
```

1.  **Data**: For the data see `?<dataset>`  
1.  **Aesthetic mappings**: All mappings in this example are position mappings.  
1.  **Layers**: There is one layer for each plot.

### Exercises 2.4.1 (page 18)

__Question 1__:  Experiment with the color, shape and size aesthetics. What happens when 
    you map them to continuous values? What about categorical values? What 
    happens when you use more than one aesthetic in a plot?
    
__Answer__:

```{r eval = FALSE}
# Categorial
ggplot(mpg, aes(cty, displ, colour = class)) + 
  geom_point()

# Continuous 
ggplot(mpg, aes(cty, hwy, size = displ)) + 
  geom_jitter()

## Doesnt work for shape
ggplot(mpg, aes(cty, hwy, shape = displ)) + 
  geom_jitter()

```

All aesthetics that have a natural continuous scale can be used for both continuous
and discrete variables.

__Question 2__: What happens if you map a continuous variable to shape? Why? What happens
    if you map `trans` to shape? Why?
    
__Answer__: As mentioned before: all aesthetics that have a natural continuous scale
can be used for both continuous and discrete variables. Shape doesn't have 
a continuous scale so it throws an error. When a discrete variable has more than
6 different values its hard to discriminate hence we get a warning.

```{r}
ggplot(mpg, aes(cty, hwy, shape = trans)) + 
  geom_point()
```

    
__Question 3__: How is drive train related to fuel economy? How is drive train related to
    engine size and class?

__Answer__:

```{r}
ggplot(mpg, aes(drv, cty)) + 
  geom_boxplot()
```

